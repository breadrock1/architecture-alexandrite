# Планирование: анализ, идентификация проблем и поиск решений

## Анализ схемы и описания системы

В данной системе небольшое количество сервисов, среди них можно выделить 3 основные группы: Internal Shop, CRM, MES.

В каждой группе имеется собственная БД: Internal Shop - Shop DB; MES - MES DB; CRM - RabbitMQ.
Также все группы имеют доступ к 3D File Storage. 

В описании к системе отсуствует какая-либо информация о том, как развернута система: 
 - сколько реплик у БД;
 - имеется-ли настроенный sharding БД.

Учитывая относительно небольшое количество пользователей, подразумеваю, что репликация и шардирование отсутствует.
Шардирование скорее всего здесь совсем не самое подходящее решение, так как обычно данных подход применяется к более
высоконагруженным системам.

Жалобы пользователей на систему:
 - клиенты не получили заказ;
 - сильные задержки по разработки изделия (не со стороны производтства);
 - представители компаний жалуются - не получили свои заказы;
 - операторы жалуются на долгую загрузки MES.

Исходя из всех условий можно выделить следующие существующие и потенциальные проблемные места:
 - отсутствие репликации к загруженным БД, что позволит разделить операции чтения/записи;
 - отcутствие кэширования данных для БД, где проседает нагрузка, что заставляет пользователей ожидать;
 - в зависимости от настройки типа очереди в RabbitMQ некоторые данные могут теряться, что является потенциальной проблемой;
 - отсутствие репликации для 3D File Storage, а также отсутствие кэширования актуальных 3D схем из S3.

## Инициативы, необходимыу для устранения нежелательных ситуаций

Среди инициатив стоит выделить следующие:
 - необходимо настроить систему мониторинга системы (метрики), с помощью которого можно получить картину о работе системы;
 - необходимо настроить централизованный сбор и хранение лог-сообщений, что позволит отслеживать и реагировать на аномалии в работе сервисов;
 - реализовать механизмы отказоустойчивости: backpressure или circuit-breaker;
 - настроить кэширование, в частности, это касается критически важных сервисов;
 - настроить трэйсинг системы, так как проблемы с заказами могут появляться потому что сообщения теряются.

Относительно приоритетов я бы расставил инициативы в следующем порядке:
 1. Наблюдаемость - настроить сбор метрик, логирование и трэйсинг с целью выявить проблемные места в работе системы;
 2. Анализ наблюдаемых данных в работе системы. В результате должен быть сформирован отчет об узких местах в системе;
 3. Реализовать механизмы отказоустойчивости: backpressure или circuit-breaker;
 4. Применение кэширования данных в системе с целью повышения доступности системы.

**Целевая архитектура должна обеспечить непрерывный мониторинг нагрузки и масштабирование компонентов, приближающихся к 
пределу нагрузки и возможность масштабирования сервисов, которые становятся узким местом при росте нагрузки.**
